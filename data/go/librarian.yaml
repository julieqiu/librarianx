version: v1
language: go

sources:
  googleapis:
    url: https://github.com/googleapis/googleapis/archive/9fcfbea0aa5b50fa22e190faceb073d74504172b.tar.gz
    sha256: 81e6057ffd85154af5268c2c3c8f2408745ca0f7fa03d43c68f4847f31eb5f98

global:
  files_allowlist:
    - path: internal/generated/snippets/go.mod
      permissions: read-write
    - path: CHANGES.md
      permissions: read-write

defaults:
  generate_dir: '{name}/'
  transport: grpc+rest
  rest_numeric_enums: true

release:
  tag_format: '{name}/v{version}'

# Auto-discover everything from googleapis api-index-v1.json
auto_discover: true

# Only configure exceptions to the defaults
libraries:
  # Exception: needs handwritten IAM client
  - batch:
      keep:
        - ^batch/apiv1/iam_policy_client\.go$

  - datacatalog:
      keep:
        - ^datacatalog/apiv1/iam_policy_client\.go$

  - datastream:
      keep:
        - ^datastream/apiv1/iam_policy_client\.go$

  - run:
      keep:
        - ^run/apiv2/locations_client\.go$

  - vmmigration:
      keep:
        - ^vmmigration/apiv1/iam_policy_client\.go$

  # Exception: handwritten libraries (no generation)
  - auth:
      release:
        disabled: true

  - auth/oauth2adapt:
      release:
        disabled: true

  - bigtable:
      release:
        disabled: true

  - compute/metadata:
      release:
        disabled: true

  - profiler:
      release:
        disabled: true

  - vertexai:
      release:
        disabled: true

  # Exception: special multi-source module
  - root-module:
      source_roots:
        - civil
        - httpreplay
        - internal
        - rpcreplay
      release:
        disabled: true

  # Exception: has special keep patterns
  - gkehub:
      keep:
        - docs/gkehub_v1/configmanagement_v1
        - docs/gkehub_v1/multiclusteringress_v1
        - google/cloud/gkehub_v1/configmanagement_v1
        - google/cloud/gkehub_v1/multiclusteringress_v1

  # Exception: release disabled (used differently)
  - bigquery:
      release:
        disabled: true
      keep:
        - ^internal/generated/snippets/bigquery/v2/

  - bigquery/v2:
      release:
        disabled: true

  - datastore:
      release:
        disabled: true

  - errorreporting:
      release:
        disabled: true

  - firestore:
      release:
        disabled: true

  - logging:
      release:
        disabled: true

  - longrunning:
      release:
        disabled: true

  - pubsub:
      release:
        disabled: true

  - pubsub/v2:
      release:
        disabled: true

  - pubsublite:
      release:
        disabled: true

  - spanner:
      release:
        disabled: true

  - storage:
      release:
        disabled: true
